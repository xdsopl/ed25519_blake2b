<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Crypto Module</title>
</head>
<body style="color: white; background-color: black;">
<script>
function print_str(str) {
	document.getElementById("output").innerHTML += str + "<br />";
}
function print_hex(name, buffer, length) {
	let str = name + ": ";
	for (let i = 0; i < length; ++i)
		str += buffer[i].toString(16).padStart(2, '0').toUpperCase();
	print_str(str);
}
function print_ms(name, start, end) {
	print_str(name + ": " + (end - start).toFixed(2) + " ms");
}
WebAssembly.instantiateStreaming(fetch("crypto.wasm"))
	.then(obj => {
		const wasm = obj.instance.exports;
		buffer = wasm.memory.buffer;
		//console.log(wasm);
		let private_key = new Uint8Array(buffer, wasm.keypair, 32);
		let start = performance.now();
		crypto.getRandomValues(private_key);
		let end = performance.now();
		print_ms("getRandomValues", start, end);
		print_hex("Private Key", private_key, 32);
		start = performance.now();
		wasm.create_keypair();
		end = performance.now();
		print_ms("create_keypair", start, end);
		let fingerprint = new Uint8Array(buffer, wasm.keypair+32, 32);
		print_hex("Fingerprint", fingerprint, 32);
		let message_length = 42;
		let signed_length = message_length + 64;
		let message = new Uint8Array(buffer, wasm.message, 1024);
		for (let i = 0; i < message_length; ++i)
			message[i] = Math.trunc(Math.random() * 256);
		print_hex("Message", message, message_length);
		start = performance.now();
		wasm.sign_message(message_length);
		end = performance.now();
		print_ms("sign_message", start, end);
		print_hex("Signed", message, signed_length);
		//message[Math.trunc(Math.random() * signed_length)] ^= 1 << Math.trunc(Math.random() * 8);
		start = performance.now();
		if (wasm.open_message(signed_length) < 0)
			print_str("Verification failed!");
		end = performance.now();
		print_ms("open_message", start, end);
		print_hex("Message", message, message_length);
	});
</script>
<p>
<h1>Playing with Ed25519 and BLAKE2b</h1>
WebAssembly crypto module for digital signing based on Ed25519 and BLAKE2B<br />
Copyright 2024 Ahmet Inan &lt;xdsopl@gmail.com&gt;<br />
</p>
<p id="output"></p>
</body>
</html>
